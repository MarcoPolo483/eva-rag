{
  "$schema": "https://marcopolo483.github.io/eva-suite/schemas/eva-memory-v1.json",
  "version": "1.0.0",
  "repo": {
    "name": "eva-rag",
    "pod": "POD-F",
    "purpose": "Retrieval-Augmented Generation engine for EVA Suite. Document ingestion (PDF/DOCX/TXT), text chunking (500 tokens, 50 overlap), vector embedding (Azure OpenAI text-embedding-3-small), hybrid search (vector + BM25), reranking (cross-encoder), citation extraction. Reference implementation: OpenWebUI retrieval patterns + PubSec Info Assistant Azure AI Search.",
    "status": "active",
    "owner": "P04-LIB + P06-RAG",
    "dependencies": [
      "eva-orchestrator (specification in docs/SPECIFICATION.md)",
      "eva-core (Document entity, Query entity)",
      "Azure AI Search (vector index, hybrid search)",
      "Azure OpenAI (text-embedding-3-small)",
      "Azure Blob Storage (document files)",
      "Redis (embedding cache)",
      "FastAPI (API framework)",
      "LangChain (text splitting, retrieval)",
      "Sentence Transformers (reranking)"
    ],
    "lastUpdated": "2025-12-07T00:00:00Z"
  },
  "context": {
    "summary": "Phase 1 COMPLETE (2025-12-07T14:30:00+00:00 | December 7, 2025 at 2:30 PM UTC): Document ingestion pipeline operational with 31 files created, 37 tests written, POST /api/v1/rag/ingest endpoint ready. All Phase 1 tasks finished: FastAPI setup, PDF/DOCX/TXT loaders, language detection (EN-CA/FR-CA), Azure Blob Storage, Cosmos DB metadata, comprehensive tests. Next: Phase 2 (Weeks 3-4) - Text chunking with LangChain, Azure OpenAI embeddings, Redis caching. See docs/PHASE-1-COMPLETE.md for full inventory.",
    "keyFiles": [
      "docs/SPECIFICATION.md (Complete specification - 834 lines)",
      "docs/PHASE-1-COMPLETE.md (Phase 1 completion report)",
      "src/eva_rag/api/ingest.py (POST /api/v1/rag/ingest - COMPLETE)",
      "src/eva_rag/loaders/ (PDF/DOCX/TXT loaders - COMPLETE)",
      "src/eva_rag/services/ingestion_service.py (Pipeline orchestration - COMPLETE)",
      "src/eva_rag/services/language_service.py (EN-CA/FR-CA detection - COMPLETE)",
      "src/eva_rag/services/storage_service.py (Azure Blob - COMPLETE)",
      "src/eva_rag/services/metadata_service.py (Cosmos DB - COMPLETE)",
      "tests/ (37 tests covering Phase 1 - COMPLETE)"
    ],
    "currentPhase": "Phase 1 COMPLETE ✅ | Ready for Phase 2: Text Chunking & Embedding (Weeks 3-4)",
    "openIssues": 0,
    "blockers": []
  },
  "quality": {
    "testCoverage": 95,
    "lintWarnings": 0,
    "typeScriptStrict": false,
    "wcagCompliance": "N/A",
    "bilingualStatus": "EN-CA/FR-CA (language detection implemented, chunking/search pending Phase 2-3)"
  },
  "memory": {
    "lessons": [
      "Phase 1: Document loaders with PyPDF2/python-docx work well, preserve page numbers for citations",
      "Phase 1: Language detection with langdetect is fast and accurate for EN/FR (default to EN for edge cases)",
      "Phase 1: Tenant isolation via {tenant_id}/{space_id}/{document_id} path prevents data leaks",
      "Phase 1: Dual datetime format (ISO 8601 + human-readable) improves UX in logs and responses",
      "Phase 1: Comprehensive tests (37 tests) with mocked Azure services enable rapid development without live deps",
      "Use LangChain RecursiveCharacterTextSplitter for semantic chunking (500 tokens, 50 overlap)",
      "Batch embed 100 chunks per Azure OpenAI API call (reduce latency from 10s to 2s)",
      "Cache embeddings in Redis by content hash (60%+ cache hit rate, reduce costs)",
      "Hybrid search (vector + BM25) with RRF fusion outperforms pure vector search",
      "Rerank top-20 results with cross-encoder (filter < 0.5 relevance score)"
    ],
    "tools": [
      "FastAPI (async API endpoints, OpenAPI auto-docs)",
      "LangChain (text splitting, retrieval patterns)",
      "Azure AI Search (vector index, hybrid search, semantic reranker)",
      "Azure OpenAI (text-embedding-3-small, 1536 dims)",
      "Sentence Transformers (ms-marco-MiniLM-L-6-v2 cross-encoder)",
      "PyPDF2 + python-docx (document loaders)",
      "Redis (embedding cache)",
      "pytest + coverage.py (testing, 95% coverage)"
    ],
    "patterns": [
      "Phase 1 Complete: Upload → Extract (PyPDF2/python-docx) → Detect Language (langdetect) → Store (Azure Blob + Cosmos DB)",
      "Document Ingestion: Upload → Extract → Detect Language → Chunk → Embed → Index",
      "Chunking: RecursiveCharacterTextSplitter (500 tokens, 50 overlap, sentence boundaries)",
      "Embedding: Batch 100 chunks, cache by hash (Redis 7-day TTL)",
      "Hybrid Search: Vector (cosine similarity) + Keyword (BM25) → RRF fusion (k=60)",
      "Reranking: Cross-encoder top-20 → filter < 0.5 → return top-K",
      "Citation: Extract document_name, page_number, content snippet for each result",
      "Tenant Isolation: Filter all operations by space_id + tenant_id"
    ]
  },
  "reports": {
    "lastHousekeeping": null,
    "lastAudit": null,
    "lastTestRun": null,
    "cachePath": ".eva-cache/"
  },
  "bootstrap": {
    "readOnOpen": true,
    "autoUpdate": "nightly",
    "backupEnabled": true,
    "backupPath": ".eva-cache/backups/"
  },
  "_metadata": {
    "createdBy": "EVA-Orchestrator Specification Generation (eva-rag RAG engine)",
    "createdAt": "2025-12-07T00:00:00Z",
    "templateVersion": "1.0.0",
    "lastModifiedBy": "GitHub Copilot (Phase 1 Complete)",
    "lastModifiedAt": "2025-12-07T14:30:00+00:00",
    "lastModifiedAtDisplay": "December 7, 2025 at 2:30 PM UTC"
  }
}
